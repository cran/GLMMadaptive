<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Dimitris Rizopoulos" />

<meta name="date" content="2020-06-25" />

<title>GLMMadaptive Basics</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">GLMMadaptive Basics</h1>
<h4 class="author">Dimitris Rizopoulos</h4>
<h4 class="date">2020-06-25</h4>


<div id="TOC">
<ul>
<li><a href="#generalized-linear-mixed-models---theory">Generalized Linear Mixed Models - Theory</a><ul>
<li><a href="#model-specification">Model Specification</a></li>
<li><a href="#estimation">Estimation</a></li>
</ul></li>
<li><a href="#generalized-linear-mixed-models---practice">Generalized Linear Mixed Models - Practice</a><ul>
<li><a href="#mixed-effects-logistic-regression">Mixed Effects Logistic Regression</a></li>
<li><a href="#penalized-mixed-effects-poisson-regression">Penalized Mixed Effects Poisson Regression</a></li>
</ul></li>
</ul>
</div>

<div id="generalized-linear-mixed-models---theory" class="section level1">
<h1>Generalized Linear Mixed Models - Theory</h1>
<div id="model-specification" class="section level2">
<h2>Model Specification</h2>
<p>Package <strong>GLMMadaptive</strong> provides a suit of functions for fitting and post-processing mixed effects models for grouped/clustered outcomes which have a distribution other than a normal distribution. In particular, let <span class="math inline">\(y_i\)</span> denote a vector of grouped/clustered outcome for the <span class="math inline">\(i\)</span>-th sample unit (<span class="math inline">\(i = 1, \ldots, n\)</span>). The conditional distribution of <span class="math inline">\(y_i\)</span> given a vector of random effects <span class="math inline">\(b_i\)</span> is assumed to be a member of the extended exponential family, with linear predictor given by <span class="math display">\[g\{E(y_i \mid b_i)\} = X_i \beta + Z_i b_i,\]</span> where <span class="math inline">\(g(\cdot)\)</span> denotes a monotonic link function, <span class="math inline">\(X_i\)</span> a design matrix for the fixed effects coefficients <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(Z_i\)</span> a design matrix for the random effects coefficients <span class="math inline">\(b_i\)</span>. Typically, matrix <span class="math inline">\(Z_i\)</span> is assumed to be a subset of <span class="math inline">\(X_i\)</span>. The random effects are assumed to follow a normal distribution with mean 0 and variance-covariance matrix <span class="math inline">\(D\)</span>. In addition, the distribution <span class="math inline">\([y_i \mid b_i]\)</span> may potentially have extra dispersion/shape parameters <span class="math inline">\(\phi\)</span>.</p>
</div>
<div id="estimation" class="section level2">
<h2>Estimation</h2>
<p>The package focuses in settings in which the distribution <span class="math inline">\([y_i \mid b_i]\)</span> is not normal and/or the link function <span class="math inline">\(g(\cdot)\)</span> is not the identity. In these settings, the estimation of the model is complicated by the fact that the marginal log-likelihood function of the observed <span class="math inline">\(y_i\)</span> cannot be derived analytically. In particular, the log-likelihood function has the form: <span class="math display">\[\begin{eqnarray*}
\ell(\theta) &amp; = &amp; \sum_{i = 1}^n \log p(y_i; \theta)\\
&amp; = &amp; \sum_{i = 1}^n \log \int p(y_i \mid b_i; \theta) \, p(b_i; \theta) \, db_i,
\end{eqnarray*}\]</span> where <span class="math inline">\(\theta\)</span> denotes the full parameter vector including the fixed effects, the extra potential dispersion/shape parameters <span class="math inline">\(\phi\)</span> and the unique element of the covariance matrix <span class="math inline">\(D\)</span>, and <span class="math inline">\(p(\cdot)\)</span> denotes a probability density or probability mass function. The integral in the definition of <span class="math inline">\(\ell(\theta)\)</span> does not have a closed-form solution, and numerical approximations are required to obtain the maximum likelihood estimates.</p>
<p>In the literature several approaches have been proposed to approximate such integrals, and a nice overview is given in <a href="https://doi.org/10.1198/106186006X96962">Pinheiro and Chao (2006)</a>. A typical approach to approximate these integrals is the Laplace approximation. However, the general consensus has been that in the standard but difficult cases of binary/dichotomous data and count data with small counts and few repeated measurements, the accuracy of this approximation is rather low. Due to this fact, the general consensus is that the gold standard numerical approximation method is the adaptive Gaussian quadrature rule (<em>note: we focus here on maximum likelihood estimation; under the Bayesian paradigm, approaches, such as, MCMC and Hamiltonian Monte Carlo also provide accurate evaluation of the integrals</em>). This is more computationally intensive but also more accurate. This package provides an efficient implementation of the adaptive Gaussian quadrature rule, allowing for multiple correlated random effects (e.g., random intercepts, linear and quadratic random slopes) but currently a single grouping factor (i.e., no nested or crossed random effects designs).</p>
<p>A hybrid optimization procedure is implemented starting with an EM algorithm, treating the random effects as ‘missing data’, followed by a direct optimization procedure with a quasi-Newton algorithm. Fine control of this procedure is allowed with a series of control arguments.</p>
</div>
</div>
<div id="generalized-linear-mixed-models---practice" class="section level1">
<h1>Generalized Linear Mixed Models - Practice</h1>
<div id="mixed-effects-logistic-regression" class="section level2">
<h2>Mixed Effects Logistic Regression</h2>
<p>We illustrate the use of the package in the standard case of a mixed effects logistic regression. That is, the distribution of <span class="math inline">\([y_i \mid b_i]\)</span> is binomial, and the distribution of <span class="math inline">\([b_i]\)</span> multivariate normal.</p>
<p>We start by simulating some data for a binary longitudinal outcome:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>n &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># number of subjects</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>K &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># number of measurements per subject</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>t_max &lt;-<span class="st"> </span><span class="dv">15</span> <span class="co"># maximum follow-up time</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># we constuct a data frame with the design: </span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># everyone has a baseline measurment, and then measurements at random follow-up times</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>DF &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">rep</span>(<span class="kw">seq_len</span>(n), <span class="dt">each =</span> K),</span>
<span id="cb1-9"><a href="#cb1-9"></a>                 <span class="dt">time =</span> <span class="kw">c</span>(<span class="kw">replicate</span>(n, <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">sort</span>(<span class="kw">runif</span>(K <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">0</span>, t_max))))),</span>
<span id="cb1-10"><a href="#cb1-10"></a>                 <span class="dt">sex =</span> <span class="kw">rep</span>(<span class="kw">gl</span>(<span class="dv">2</span>, n<span class="op">/</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)), <span class="dt">each =</span> K))</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># design matrices for the fixed and random effects</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">data =</span> DF)</span>
<span id="cb1-14"><a href="#cb1-14"></a>Z &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span>time, <span class="dt">data =</span> DF)</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a>betas &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">2.13</span>, <span class="fl">-0.25</span>, <span class="fl">0.24</span>, <span class="fl">-0.05</span>) <span class="co"># fixed effects coefficients</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>D11 &lt;-<span class="st"> </span><span class="fl">0.48</span> <span class="co"># variance of random intercepts</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>D22 &lt;-<span class="st"> </span><span class="fl">0.1</span> <span class="co"># variance of random slopes</span></span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co"># we simulate random effects</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>b &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="kw">sqrt</span>(D11)), <span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="kw">sqrt</span>(D22)))</span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co"># linear predictor</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>eta_y &lt;-<span class="st"> </span><span class="kw">drop</span>(X <span class="op">%*%</span><span class="st"> </span>betas <span class="op">+</span><span class="st"> </span><span class="kw">rowSums</span>(Z <span class="op">*</span><span class="st"> </span>b[DF<span class="op">$</span>id, ]))</span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co"># we simulate binary longitudinal data</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>DF<span class="op">$</span>y &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n <span class="op">*</span><span class="st"> </span>K, <span class="dv">1</span>, <span class="kw">plogis</span>(eta_y))</span></code></pre></div>
<p>We fit a mixed effects logistic regression for <code>y</code>, assuming random intercepts for the random-effects part. The basic model-fitting function in <strong>GLMMadaptive</strong> is called <code>mixed_model()</code>, and has four required arguments, namely <code>fixed</code> a formula for the fixed effects, <code>random</code> a formula for the random effects, <code>family</code> a family object specifying the type of response variable, and <code>data</code> a data frame containing the variables in the previously mentioned formulas. Hence, the call to fit the random intercepts logistic regression is:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>fm1 &lt;-<span class="st"> </span><span class="kw">mixed_model</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id, <span class="dt">data =</span> DF,</span>
<span id="cb2-2"><a href="#cb2-2"></a>                   <span class="dt">family =</span> <span class="kw">binomial</span>())</span></code></pre></div>
<p>The summary method gives a detailed output of the model:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">summary</span>(fm1)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#&gt; </span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; Call:</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; mixed_model(fixed = y ~ sex * time, random = ~1 | id, data = DF, </span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt;     family = binomial())</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; Data Descriptives:</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; Number of Observations: 800</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; Number of Groups: 100 </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; </span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; Model:</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt;  family: binomial</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt;  link: logit </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; Fit statistics:</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt;    log.Lik      AIC      BIC</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt;  -374.5197 759.0394 772.0653</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; </span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; Random effects covariance matrix:</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt;               StdDev</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; (Intercept) 2.064622</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; </span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt;                Estimate Std.Err z-value  p-value</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; (Intercept)     -2.6182  0.4448 -5.8862  &lt; 1e-04</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">#&gt; sexfemale       -1.3242  0.6436 -2.0575 0.039639</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">#&gt; time             0.2851  0.0396  7.2089  &lt; 1e-04</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; sexfemale:time   0.0402  0.0545  0.7372 0.461005</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">#&gt; </span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">#&gt; Integration:</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">#&gt; method: adaptive Gauss-Hermite quadrature rule</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">#&gt; quadrature points: 11</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt; </span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; Optimization:</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">#&gt; method: hybrid EM and quasi-Newton</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#&gt; converged: TRUE</span></span></code></pre></div>
<p>We continue by checking the impact of the chosen number of quadrature points to the parameters estimates and the log-likelihood value at convergence. First, we refit the model with an increasing number of quadrature points. The default when the number of random effects is smaller or equal to two is 11 points. We fit then with 15, and 21 points:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>fm1_q11 &lt;-<span class="st"> </span>fm1</span>
<span id="cb4-2"><a href="#cb4-2"></a>fm1_q15 &lt;-<span class="st"> </span><span class="kw">update</span>(fm1_q11, <span class="dt">nAGQ =</span> <span class="dv">15</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>fm1_q21 &lt;-<span class="st"> </span><span class="kw">update</span>(fm1_q11, <span class="dt">nAGQ =</span> <span class="dv">21</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>models &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;nAGQ=11&quot;</span> =<span class="st"> </span>fm1_q11, <span class="st">&quot;nAGQ=15&quot;</span> =<span class="st"> </span>fm1_q15, <span class="st">&quot;nAGQ=21&quot;</span> =<span class="st"> </span>fm1_q21)</span></code></pre></div>
<p>We now extract from the model the estimated parameter for the fixed effects (using function <code>fixef()</code>), for the random effects, and the log-likelihood (using function <code>logLik()</code>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>extract &lt;-<span class="st"> </span><span class="cf">function</span> (obj) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="kw">c</span>(<span class="kw">fixef</span>(obj), <span class="st">&quot;var_(Intercept)&quot;</span> =<span class="st"> </span>obj<span class="op">$</span>D[<span class="dv">1</span>, <span class="dv">1</span>], <span class="st">&quot;logLik&quot;</span> =<span class="st"> </span><span class="kw">logLik</span>(obj))</span>
<span id="cb5-3"><a href="#cb5-3"></a>}</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">sapply</span>(models, extract)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;                       nAGQ=11       nAGQ=15      nAGQ=21</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; (Intercept)       -2.61816557   -2.61679077   -2.6168440</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; sexfemale         -1.32418678   -1.32349829   -1.3235049</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; time               0.28514773    0.28501148    0.2850151</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; sexfemale:time     0.04015372    0.04020003    0.0401995</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; var_(Intercept)    4.26266211    4.26351799    4.2636311</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; logLik          -374.51972108 -374.51983340 -374.5198046</span></span></code></pre></div>
<p>We observe a rather stable model with virtually no differences between the different choices of quadrature points.</p>
<p>We first compare the model with a simple logistic regression that does not include any random effects:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>km &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">data =</span> DF, <span class="dt">family =</span> <span class="kw">binomial</span>())</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">anova</span>(fm1, km)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;        AIC    BIC log.Lik    LRT df p.value</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; fm1 759.04 772.07 -374.52                  </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; km  919.11 937.85 -455.55 162.07  1 &lt;0.0001</span></span></code></pre></div>
<p>We obtain a highly significant p-value suggesting that there are correlations in the data that cannot be ignored. <em>Note:</em> the <code>anova()</code> method that performs the likelihood ratio test calculates the p-value using the standard <span class="math inline">\(\chi^2\)</span> distribution, here with one degree of freedom. However, because the null hypothesis for testing variance parameters is on the boundary of the corresponding parameter space, it would be more appropriate to use a mixture of <span class="math inline">\(\chi^2\)</span> distributions.</p>
<p>We extend model <code>fm1</code> by also including a random slopes term; however, we assume that the covariance between the random intercepts and random slopes is zero. This is achieved by using the <code>||</code> symbol in the specification of the <code>random</code> argument, i.e.,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>fm2 &lt;-<span class="st"> </span><span class="kw">mixed_model</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>time <span class="op">||</span><span class="st"> </span>id, <span class="dt">data =</span> DF,</span>
<span id="cb7-2"><a href="#cb7-2"></a>                   <span class="dt">family =</span> <span class="kw">binomial</span>())</span></code></pre></div>
<p>The likelihood ratio test between the two models is computed with function <code>anova()</code>. When two <code>&quot;MixMod&quot;</code> objects are provided, the function assumes that the first object represents the model under the null hypothesis, and the second object the model under the alternative, i.e.,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">anova</span>(fm1, fm2)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt; </span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt;        AIC    BIC log.Lik  LRT df p.value</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt; fm1 759.04 772.07 -374.52                </span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; fm2 730.94 746.57 -359.47 30.1  1 &lt;0.0001</span></span></code></pre></div>
<p>The results suggest that we need the random slopes term. We continue by testing whether the covariance between the random effects terms is zero. The model under the alternative hypothesis is (results not shown):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>fm3 &lt;-<span class="st"> </span><span class="kw">mixed_model</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span>time <span class="op">|</span><span class="st"> </span>id, <span class="dt">data =</span> DF,</span>
<span id="cb9-2"><a href="#cb9-2"></a>                   <span class="dt">family =</span> <span class="kw">binomial</span>())</span></code></pre></div>
<p>And again the likelihood ratio test is performed by a call to <code>anova()</code> (results not shown):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">anova</span>(fm2, fm3)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">#&gt; </span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">#&gt;        AIC    BIC log.Lik  LRT df p.value</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt; fm2 730.94 746.57 -359.47                </span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; fm3 731.63 749.86 -358.81 1.32  1  0.2514</span></span></code></pre></div>
<p>The results now suggest that indeed the covariance between the two random effects terms is not statistically different from zero.</p>
</div>
<div id="penalized-mixed-effects-poisson-regression" class="section level2">
<h2>Penalized Mixed Effects Poisson Regression</h2>
<p>We continue our illustration with a Poisson mixed effects model. We start again by simulating some data for a Poisson longitudinal outcome:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>n &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># number of subjects</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>K &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># number of measurements per subject</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>t_max &lt;-<span class="st"> </span><span class="dv">15</span> <span class="co"># maximum follow-up time</span></span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># we constuct a data frame with the design: </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># everyone has a baseline measurment, and then measurements at random follow-up times</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>DF &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">rep</span>(<span class="kw">seq_len</span>(n), <span class="dt">each =</span> K),</span>
<span id="cb11-9"><a href="#cb11-9"></a>                 <span class="dt">time =</span> <span class="kw">c</span>(<span class="kw">replicate</span>(n, <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">sort</span>(<span class="kw">runif</span>(K <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">0</span>, t_max))))),</span>
<span id="cb11-10"><a href="#cb11-10"></a>                 <span class="dt">sex =</span> <span class="kw">rep</span>(<span class="kw">gl</span>(<span class="dv">2</span>, n<span class="op">/</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)), <span class="dt">each =</span> K))</span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co"># design matrices for the fixed and random effects</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">data =</span> DF)</span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a>betas &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.13</span>, <span class="fl">-0.25</span>, <span class="fl">0.24</span>, <span class="fl">-0.05</span>) <span class="co"># fixed effects coefficients</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>D11 &lt;-<span class="st"> </span><span class="fl">0.48</span> <span class="co"># variance of random intercepts</span></span>
<span id="cb11-17"><a href="#cb11-17"></a></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co"># we simulate random effects</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>b &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="kw">sqrt</span>(D11))</span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co"># linear predictor</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>eta_y &lt;-<span class="st"> </span><span class="kw">drop</span>(X <span class="op">%*%</span><span class="st"> </span>betas <span class="op">+</span><span class="st"> </span>b[DF<span class="op">$</span>id])</span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="co"># we simulate Poisson longitudinal data</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>DF<span class="op">$</span>y &lt;-<span class="st"> </span><span class="kw">rpois</span>(n <span class="op">*</span><span class="st"> </span>K, <span class="kw">exp</span>(eta_y))</span></code></pre></div>
<p>We fit the mixed effects Poisson regression for <code>y</code> assuming random intercepts for the random-effects part.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>gm1 &lt;-<span class="st"> </span><span class="kw">mixed_model</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id, <span class="dt">data =</span> DF,</span>
<span id="cb12-2"><a href="#cb12-2"></a>                   <span class="dt">family =</span> <span class="kw">poisson</span>())</span></code></pre></div>
<p>As previously, the summary method gives a detailed output of the model:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">summary</span>(gm1)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">#&gt; </span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">#&gt; Call:</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">#&gt; mixed_model(fixed = y ~ sex * time, random = ~1 | id, data = DF, </span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">#&gt;     family = poisson())</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt; </span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt; Data Descriptives:</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt; Number of Observations: 800</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; Number of Groups: 100 </span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt; </span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt; Model:</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt;  family: poisson</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt;  link: log </span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt; </span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt; Fit statistics:</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt;    log.Lik      AIC      BIC</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt;  -2782.306 5574.611 5587.637</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt; </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; Random effects covariance matrix:</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt;                StdDev</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt; (Intercept) 0.9781393</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">#&gt; </span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt;                Estimate Std.Err  z-value   p-value</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="co">#&gt; (Intercept)      2.9447  0.3082   9.5545   &lt; 1e-04</span></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co">#&gt; sexfemale       -0.8611  0.2699  -3.1906 0.0014199</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="co">#&gt; time             0.2404  0.0016 151.3464   &lt; 1e-04</span></span>
<span id="cb13-28"><a href="#cb13-28"></a><span class="co">#&gt; sexfemale:time  -0.0511  0.0028 -18.3982   &lt; 1e-04</span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="co">#&gt; </span></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="co">#&gt; Integration:</span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="co">#&gt; method: adaptive Gauss-Hermite quadrature rule</span></span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="co">#&gt; quadrature points: 11</span></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="co">#&gt; </span></span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="co">#&gt; Optimization:</span></span>
<span id="cb13-35"><a href="#cb13-35"></a><span class="co">#&gt; method: hybrid EM and quasi-Newton</span></span>
<span id="cb13-36"><a href="#cb13-36"></a><span class="co">#&gt; converged: TRUE</span></span></code></pre></div>
<p>In settings with few subjects, repeated measurements of separation effects, the package also allows to place a penalty in the fixed effects regression coefficients <span class="math inline">\(\beta\)</span>. The penalty/prior is in the form of a Student’s t distribution with mean 0, scale parameter 1, and 3 degrees of freedom, and it is placed in all <span class="math inline">\(\beta\)</span> coefficients except from the intercept. The penalized model can be fitted by setting argument <code>penalized</code> to <code>TRUE</code>, i.e.,</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>gm2 &lt;-<span class="st"> </span><span class="kw">mixed_model</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id, <span class="dt">data =</span> DF,</span>
<span id="cb14-2"><a href="#cb14-2"></a>                   <span class="dt">family =</span> <span class="kw">poisson</span>(), <span class="dt">penalized =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">cbind</span>(<span class="st">&#39;unpenalized&#39;</span> =<span class="st"> </span><span class="kw">fixef</span>(gm1), <span class="st">&#39;penalized&#39;</span> =<span class="st"> </span><span class="kw">fixef</span>(gm2))</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt;                unpenalized  penalized</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt; (Intercept)     2.94471508  2.9433924</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; sexfemale      -0.86111225 -0.8599373</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; time            0.24039444  0.2404593</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; sexfemale:time -0.05105926 -0.0511505</span></span></code></pre></div>
<p>In this example we observe small differences between the penalized and unpenalized models. The users have the option to alter the specification of the Student’s t penalty by directly specifying the mean, scale and degrees of freedom arguments of the distribution. For example, a ridge penalty could be placed by setting the degrees of freedom to a high value. The call in this case should be:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>gm3 &lt;-<span class="st"> </span><span class="kw">mixed_model</span>(<span class="dt">fixed =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>time, <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>id, <span class="dt">data =</span> DF,</span>
<span id="cb16-2"><a href="#cb16-2"></a>                   <span class="dt">family =</span> <span class="kw">poisson</span>(), </span>
<span id="cb16-3"><a href="#cb16-3"></a>                   <span class="dt">penalized =</span> <span class="kw">list</span>(<span class="dt">pen_mu =</span> <span class="dv">0</span>, <span class="dt">pen_sigma =</span> <span class="dv">1</span>, <span class="dt">pen_df =</span> <span class="dv">200</span>))</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
